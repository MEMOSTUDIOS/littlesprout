<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Little Sprout - The Adventure Begins</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap');

        :root {
            --font-main: 'Nunito', sans-serif;
            --color-background: #0D1B2A;
            --color-primary: #1B4965;
            --color-secondary: #E0E1DD;
            --color-accent: #1eb973;
            --glow-color: #ffffff;
            --board-size: 600px;
            --color-winner-glow: #feca57;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-main); background-color: var(--color-background); color: #fff;
            overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh;
        }
        
        #main-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
            max-width: 1400px;
            height: 100%;
            overflow: hidden;
        }
        
        #loader {
            font-family: var(--font-main); font-size: 1.5rem; color: var(--glow-color); position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; background: var(--color-background);
            display: flex; justify-content: center; align-items: center;
            z-index: 1000; transition: opacity 0.5s ease-out;
        }
        #loader.hidden { opacity: 0; pointer-events: none; }

        #sidebar {
            width: 280px;
            height: 90vh;
            max-height: 750px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            background: var(--color-primary);
            border-right: 2px solid var(--color-primary);
            z-index: 1111;
        }
        
        #setup-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            flex-grow: 1;
        }

        #sidebar h2 {
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--glow-color);
            text-align: center;
            margin-bottom: 0;
        }
        
        #steps-list {
            list-style: none;
            padding: 0;
            width: 100%;
            text-align: left;
            counter-reset: steps;
            margin-bottom: 0;
        }
        #steps-list li {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: #aaa;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        #steps-list li::before {
            counter-increment: steps;
            content: counter(steps) ". ";
            color: var(--color-accent);
            margin-right: 10px;
        }
        #steps-list li.step-active {
            color: var(--glow-color);
            transform: scale(1.05);
        }
        
        #interactive-controls-container {
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        #dice-container {
            display: flex; gap: 15px; cursor: pointer;
            transition: opacity 0.5s, transform 0.3s ease;
            opacity: 0;
            pointer-events: none;
        }
        #dice-container.visible {
            opacity: 1;
            pointer-events: auto;
        }
        #dice-container.selectable {
            transform: scale(1.05);
        }
        .dice { width: 45px; height: 45px; background-color: var(--color-secondary); border-radius: 8px; padding: 6px; display: grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); box-shadow: 0 3px 8px rgba(0,0,0,0.3); }
        .dot { width: 8px; height: 8px; background-color: var(--color-primary); border-radius: 50%; align-self: center; justify-self: center; }
        .dice[data-value="1"] .dot:nth-child(1){grid-area:2/2}.dice[data-value="2"] .dot:nth-child(1){grid-area:1/1}.dice[data-value="2"] .dot:nth-child(2){grid-area:3/3}.dice[data-value="3"] .dot:nth-child(1){grid-area:1/1}.dice[data-value="3"] .dot:nth-child(2){grid-area:2/2}.dice[data-value="3"] .dot:nth-child(3){grid-area:3/3}.dice[data-value="4"] .dot:nth-child(1){grid-area:1/1}.dice[data-value="4"] .dot:nth-child(2){grid-area:1/3}.dice[data-value="4"] .dot:nth-child(3){grid-area:3/1}.dice[data-value="4"] .dot:nth-child(4){grid-area:3/3}.dice[data-value="5"] .dot:nth-child(1){grid-area:1/1}.dice[data-value="5"] .dot:nth-child(2){grid-area:1/3}.dice[data-value="5"] .dot:nth-child(3){grid-area:2/2}.dice[data-value="5"] .dot:nth-child(4){grid-area:3/1}.dice[data-value="5"] .dot:nth-child(5){grid-area:3/3}.dice[data-value="6"] .dot:nth-child(1),.dice[data-value="6"] .dot:nth-child(2){grid-row:1}.dice[data-value="6"] .dot:nth-child(3),.dice[data-value="6"] .dot:nth-child(4){grid-row:2}.dice[data-value="6"] .dot:nth-child(5),.dice[data-value="6"] .dot:nth-child(6){grid-row:3}.dice[data-value="6"] .dot:nth-child(1),.dice[data-value="6"] .dot:nth-child(3),.dice[data-value="6"] .dot:nth-child(5){grid-column:1}.dice[data-value="6"] .dot:nth-child(2),.dice[data-value="6"] .dot:nth-child(4),.dice[data-value="6"] .dot:nth-child(6){grid-column:3}
        .rolling { animation: subtleRoll 0.5s ease-out; }
        @keyframes subtleRoll { 0% { transform: rotateY(0deg); } 100% { transform: rotateY(360deg); } }
        
        #color-palette { display: flex; justify-content: center; gap: 0px; transition: opacity 0.5s, transform 0.5s; opacity: 0; transform: scale(0.8); pointer-events: none; }
        #color-palette.visible { opacity: 1; transform: scale(1); pointer-events: auto; }
        
        .color-swatch {
            width: 45px;
            height: 45px;
            border-radius: 0;
            border: none;
            background-color: transparent;
            cursor: pointer;
            transition: transform 0.2s;
            padding: 2px;
        }
        .color-swatch svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.4));
        }
        .color-swatch:hover { transform: scale(1.15); }
        
        #narration-box {
            width: 100%;
            margin-top: auto;
            padding: 15px; background: none; border-radius: 15px;
            border: none;
            text-align: center;
            margin: 0 auto;
        }
        #narration-text { font-family: var(--font-main); font-size: 1rem; line-height: 1.2; color: #e1f5fe; text-shadow: 0 0 5px var(--glow-color); }
        
        #game-container { flex: 1; height: 100%; position: relative; display: flex; justify-content: center; align-items: center; }
        
        #game-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2rem;
            color: var(--glow-color);
            text-shadow: 0 0 10px var(--color-primary);
            z-index: 45;
            white-space: nowrap;
        }

        #game-board-frame {
            width: calc(var(--board-size) + 40px);
            height: calc(var(--board-size) + 40px);
            background-image: url('https://littlesprout.ro/images/board-game-little-sprout.png?q=80&w=2074&auto=format&fit=crop');
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5), inset 0 0 25px rgba(0,0,0,0.7);
            background-size: auto;
            position: absolute;
            z-index: 0;
        }

        #game-board {
            position: relative; 
            width: var(--board-size); height: var(--board-size);
            background-image: url('https://littlesprout.ro/images/little-sprout-bg.png?q=80&w=2074&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            border-radius: 50%;   
            border: 2px solid #dfe2c6;
            transform: none;
            top: auto; left: auto;
        }
        
        #spots-container { position: absolute; top: 50%; left: 50%; width: 1px; height: 1px; }

        .spot {
            position: absolute; width: 40px; height: 40px;
            top: -20px; left: -20px; 
            border-radius: 50%; cursor: pointer; transition: box-shadow 0.3s ease, background-color 0.3s;
            display: flex; justify-content: center; align-items: center;
            background-color: #ffffff; 
            color: var(--color-primary); font-size: 1.2rem; font-family: var(--font-main); font-weight: 700;
        }
        
        #center-spot { background-color: #ffffff !important; pointer-events: none; }

        .sprout-pawn {
            position: absolute; top: -17.5px; left: -17.5px;
            width: 35px; height: 35px;
            border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 10px #000, 0 0 20px #fff;
            z-index: 50;
            opacity: 0; transform: scale(0);
            transition: transform 1s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.5s;
        }
        #opponent-sprout { background-color: #6a0dad; }

        .glowing { animation: pulse-glow 1.5s infinite; }
        @keyframes pulse-glow {
            0% { box-shadow: 0 0 15px 5px var(--color-accent); }
            50% { box-shadow: 0 0 30px 10px var(--color-accent); }
            100% { box-shadow: 0 0 15px 5px var(--color-accent); }
        }

        .winning-pawn {
            animation: winning-glow 2.5s ease-in-out;
            z-index: 100 !important;
        }
        @keyframes winning-glow {
            0% { 
                transform: translate(var(--translateX, 0), var(--translateY, 0)) scale(1.2);
                box-shadow: 0 0 20px 10px var(--glow-color), 0 0 30px 15px var(--color-winner-glow);
                border-color: var(--color-winner-glow);
            }
            50% { 
                transform: translate(var(--translateX, 0), var(--translateY, 0)) scale(1.5);
                box-shadow: 0 0 40px 20px var(--glow-color), 0 0 50px 25px var(--color-winner-glow);
                border-color: var(--glow-color);
            }
            100% { 
                transform: translate(var(--translateX, 0), var(--translateY, 0)) scale(1.2);
                box-shadow: 0 0 20px 10px var(--glow-color), 0 0 30px 15px var(--color-winner-glow);
                border-color: var(--color-winner-glow);
            }
        }

        .winner-text {
            position: absolute;
            left: 0;
            top: 0;
            transform: translate(-50%, -150%);
            font-family: var(--font-main);
            font-size: 2.5rem;
            font-weight: 700;
            color: #feca57;
            text-shadow: 0 0 5px black, 0 0 15px #ff9f43;
            z-index: 101;
            pointer-events: none;
            white-space: nowrap;
            animation: fade-in-scale 1s ease-out forwards;
        }
        @keyframes fade-in-scale {
            from { opacity: 0; transform: translate(-50%, -150%) scale(0.5); }
            to { opacity: 1; transform: translate(-50%, -150%) scale(1); }
        }
        
        #card-hand {
            position: absolute; bottom: -250px; left: 50%; transform: translateX(-50%);
            width: 1100px; display: flex; justify-content: center; gap: -100px;
            transition: bottom 1s cubic-bezier(0.65, 0, 0.35, 1); z-index: 40;
        }
        #card-hand.visible { bottom: -60px; }

        #opponent-card-hand {
            position: absolute; top: -250px; left: 50%; transform: translateX(-50%);
            width: 1100px; display: flex; justify-content: center; gap: -100px;
            transition: top 1s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.5s;
            z-index: 40;
            opacity: 0.3; 
            pointer-events: none;
        }
        #opponent-card-hand.visible { top: -70px; }
        #opponent-card-hand.active { opacity: 1; }

        .card {
            width: 150px; height: 220px;
            position: relative;
            background-color: var(--color-secondary);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: flex-start;
            padding: 10px;
            border: 2px solid #1eb973;
            --rotation: 0deg;
            transform: rotate(var(--rotation));
            transition: transform 0.3s ease, opacity 0.3s ease;
            flex-shrink: 0;
        }
        .card:not(.inactive):hover {
            transform: rotate(var(--rotation)) translateY(-15px);
            z-index: 10;
        }
        .card.inactive { opacity: 0.5; transform: rotate(var(--rotation)) scale(0.95); pointer-events: none; }
        .card-title {
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--color-primary);
            text-align: center;
            width: 100%;
            margin-bottom: 10px;
        }
        .card-actions {
            width: 100%;
            display: flex; flex-direction: row; justify-content: space-around; align-items: center;
        }
        .card-image-placeholder {
            width: 100%;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 5px;
            overflow: hidden;
            background: none;
            margin-top: 0px;
        }
        .card-image-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .action-dot {
            width: 30px; height: 30px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 0.9rem;
            cursor: pointer; position: relative; pointer-events: none;
            transition: box-shadow 0.3s, opacity 0.3s;
        }
        .action-dot.white { background-color: #fff; color: #333; }
        .action-dot.black { background-color: #333; color: #fff; }
        .hand-interactable .action-dot { pointer-events: auto; }
        .action-dot::after {
            content: attr(data-tooltip); position: absolute; bottom: 125%; left: 50%;
            transform: translateX(-50%); background-color: #333; color: #fff;
            padding: 4px 8px; border-radius: 4px; font-size: 0.75rem;
            white-space: nowrap; opacity: 0; transition: opacity 0.2s; pointer-events: none;
        }
        .action-dot:hover::after { opacity: 1; }
        .glowing-action { animation: pulse-glow-action 1.5s infinite; }
        @keyframes pulse-glow-action {
            0% { box-shadow: 0 0 12px 3px var(--color-accent); }
            50% { box-shadow: 0 0 20px 6px var(--color-accent); }
            100% { box-shadow: 0 0 12px 3px var(--color-accent); }
        }

        .opponent-card {
            width: 150px; height: 220px;
            position: relative;
            background: linear-gradient(45deg, #1B4965, #0D1B2A);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            border: 2px solid #5fa8d3;
            --rotation: 0deg;
            transform: rotate(var(--rotation));
            flex-shrink: 0;
        }

        .floating-text {
            position: fixed;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffca28;
            text-shadow: 0 0 5px black;
            pointer-events: none;
            animation: float-up 1s ease-out forwards;
            z-index: 9999;
        }
        @keyframes float-up {
            from { transform: translateY(0); opacity: 1; }
            to { transform: translateY(-50px); opacity: 0; }
        }

        #reveal-section { 
            position: fixed; top:0; left:0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            opacity: 0; visibility: hidden; transition: opacity 1s ease, visibility 0s 1s; 
            z-index: 60; background: rgba(0,0,0,0.7); backdrop-filter: blur(10px); 
            padding: 40px 0;
            z-index: 9999;
        } 
        #reveal-section.visible { opacity: 1; visibility: visible; transition-delay: 0s, 0s; }
        #reveal-title { 
            font-family: var(--font-main); font-weight:700; font-size: 3rem;
            margin-bottom: 30px; text-shadow: 0 0 20px var(--glow-color);
            margin-top: -100px;
            padding-bottom: 20px;
            text-align: center;
        }
        
        .product-container-wrapper {
            position: relative;
            width: 100%;
            max-width: 80vw;
            margin: 0 auto;
        }
        .product-container { 
            padding: 20px 0;
            margin-bottom: 0;
        }
        .slider-track {
            display: flex;
            transition: transform 0.5s ease-in-out;
            gap: 40px;
            padding-bottom: 10px;
        }
        .product-box { 
            width: 240px; 
            text-align: center; 
            cursor: pointer; 
            transition: transform 0.3s ease; 
            flex-shrink: 0; 
            padding-bottom: 20px; 
        } 
        .product-box:hover { transform: scale(1.05); } 
        .product-box img { 
            width: 100%; 
            height: auto; 
            margin-bottom: 15px; 
        } 
        .slider-arrow {
            position: absolute;
            top: 40%;
            transform: translateY(-50%);
            z-index: 10;
            background-color: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s;
            user-select: none;
        }
        .slider-arrow:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }
        .slider-arrow.prev { left: -40px; }
        .slider-arrow.next { right: -40px; }

        .slider-dots {
            text-align: center;
            padding: 20px 0;
        }
        .slider-dot {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            margin: 0 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
            padding: 0;
        }
        .slider-dot.active {
            background-color: #fff;
        }
        
        .product-box h3 { font-family: var(--font-main); font-weight: 700; font-size: 1.2rem; color: #e1f5fe; } 
        .product-box p { font-size: 0.9rem; color: #ccc; max-width: 220px; margin: 10px auto; } 
        .product-box button, #replay-button, .subscribe-form button { font-family: var(--font-main); font-weight: 700; font-size: 1rem; padding: 12px 24px; border-radius: 50px; border: none; cursor: pointer; transition: all 0.3s ease; text-transform: capitalize; } 
        .product-box button, .subscribe-form button { background: linear-gradient(45deg, #62B6CB, #1B4965); color: #fff; box-shadow: 0 4px 15px rgba(98, 182, 203, 0.4); } 
        .product-box button:hover, .subscribe-form button:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(98, 182, 203, 0.6); } 
        #replay-button { background: transparent; color: var(--glow-color); border: 2px solid var(--glow-color); } 
        #replay-button:hover { background: var(--glow-color); color: var(--color-background); }

        #reveal-footer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            margin-top: 20px;
        }
        .subscribe-form {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .subscribe-form input {
            padding: 12px 20px;
            border-radius: 50px;
            border: 2px solid var(--color-accent);
            background-color: rgba(255,255,255,0.1);
            color: #fff;
            font-family: var(--font-main);
            font-size: 1rem;
        }
        .subscribe-form input::placeholder { color: #ccc; }
        
        #subscription-alert {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--color-accent);
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 10001;
            display: flex;
            align-items: center;
            gap: 10px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s, transform 0.5s, visibility 0.5s;
        }
        #subscription-alert.visible {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, 10px);
        }

        .modal {
            position: fixed;
            inset: 0;
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        .modal.visible {
            opacity: 1;
            visibility: visible;
            transition-delay: 0s, 0s;
        }
        .modal-overlay {
            position: absolute;
            inset: 0;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }
        .modal-content {
            position: relative;
            background-color: var(--color-primary);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            width: 100%;
            max-width: 500px;
            color: var(--color-secondary);
            transform: scale(0.95);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
        .modal.visible .modal-content {
            transform: scale(1);
            opacity: 1;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .modal-header h3 { font-size: 1.5rem; color: var(--glow-color); }
        .modal-close-btn { background: none; border: none; color: var(--color-secondary); font-size: 1.5rem; cursor: pointer; line-height: 1; }
        .modal-body { padding: 1.5rem; }
        .modal-body .form-group { margin-bottom: 1rem; }
        .modal-body label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: #ccc; }
        .modal-body input, .modal-body textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 8px;
            border: 2px solid #62B6CB;
            background-color: var(--color-background);
            color: #fff;
            font-family: var(--font-main);
            font-size: 1rem;
        }
        .modal-body button {
            width: 100%;
            font-family: var(--font-main);
            font-weight: 700;
            font-size: 1.1rem;
            padding: 1rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(45deg, var(--color-accent), #1a9c6a);
            color: #fff;
            box-shadow: 0 4px 15px rgba(30, 185, 115, 0.4);
        }
        .modal-body button:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(30, 185, 115, 0.6); }

        #confirmation-message { display: none; text-align: center; padding: 2rem; }
        #confirmation-message svg { margin: 0 auto 1rem; }

        @media (max-width: 1200px) {
            :root { --board-size: 500px; }
            #sidebar { width: 220px; }
            #game-title { font-size: 1.5rem; }
            .card, .opponent-card { width: 130px; height: 192px; }
            #card-hand, #opponent-card-hand { width: 900px; gap: -40px; }
        }
        
        @media (max-width: 768px) {
            :root { --board-size: 80vw; } 

            #main-container {
                flex-direction: column;
                position: relative;
            }

            #sidebar {
                width: 100%; 
                height: auto; 
                max-height: 110px;
                flex-shrink: 0;
                flex-direction: column;
                border-right: none; 
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                padding: 10px;
                z-index: 500;
                background: rgba(27, 73, 101, 0.85);
                backdrop-filter: blur(8px);
                -webkit-backdrop-filter: blur(8px);
                box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            }
            #sidebar h2, #steps-list { display: none; }
            #setup-controls { 
                flex-direction: column; 
                gap: 15px; 
                width: 100%; 
            }
            #narration-box { margin-top: 0; width: 100%; order: -1; padding: 15px 0px;  }
            
            #interactive-controls-container {
                min-height: auto;
            }

            .spot {
                width: 25px; height: 25px;
                top: -12.5px; left: -12.5px;
                font-size: 0.7rem;
            }
            .sprout-pawn {
                width: 20px; height: 20px;
                top: -10px; left: -10px;
            }
            .winner-text { font-size: 1.8rem; }

            #game-container { 
                flex: 1; 
                width: 100%; 
                padding-bottom: 140px; 
            }

            #game-board-frame,
            #game-board {
                aspect-ratio: 1 / 1;
                height: var(--board-size);
            }

            #game-title { 
                font-size: 1.2rem; 
                display: none; 
            }
            #card-hand.visible { bottom: 40px; }
            #card-hand { width: 95vw; gap: -75px; }
            .card { width: 100px; height: 160px; padding: 5px; }
            .card-actions { margin-bottom: 0px; }
            .action-dot { width: 20px; height: 20px; font-size: 0.7rem; }
            .card-title { font-size: 0.5rem; }

            #opponent-card-hand.visible { top: -70px; }
            #opponent-card-hand { width: 95vw; gap: -75px; }
            .opponent-card { width: 100px; height: 140px; }
            
            /* --- START: NEW MOBILE POPUP STYLES --- */
            #reveal-section {
                overflow-y: auto; /* Make the whole popup scrollable */
                -webkit-overflow-scrolling: touch;
                padding: 60px 20px; /* Add padding for content spacing */
                display: block; /* Reset layout for simple scrolling */
                height: 100%;
                box-sizing: border-box;
                justify-content: flex-start; /* Align content to the top */
            }

            #reveal-title {
                font-size: 2rem;
                margin-top: 0;
                margin-bottom: 40px;
                padding-bottom: 0;
                text-align: center;
            }

            /* Unset styles from the slider JS */
            .product-container-wrapper {
                all: unset;
            }

            #product-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 30px;
                padding: 0;
                margin: 0;
                overflow: visible;
            }

            .product-box {
                width: 100%;
                max-width: 350px;
                padding-bottom: 0;
                scroll-snap-align: none;
            }
            
            .slider-arrow, .slider-dots {
                display: none !important;
            }

            #reveal-footer {
                width: 100%;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
                margin-top: 50px; /* Space above the replay button */
                padding: 0;
            }

            #replay-button {
                position: static;
                transform: none;
                width: 100%;
                max-width: 350px;
            }
            
            .subscribe-form {
                display: flex;
                flex-direction: column; /* Stack input and button */
                gap: 15px;
                align-items: center;
                width: 100%;
                max-width: 350px;
                padding: 20px;
                border-radius: 15px;
                background: rgba(255, 255, 255, 0.3);
            }
            
            .subscribe-form input,
            .subscribe-form button {
                width: 100%;
            }
             /* --- END: NEW MOBILE POPUP STYLES --- */
        }
    </style>
</head>
<body>
    <div id="loader">The Forest is Waking Up...</div>
    <div id="main-container">
        <div id="sidebar">
            <div id="setup-controls">
                <h2>Start Your Adventure</h2>
                <ol id="steps-list">
                    <li id="step-1">Choose Your Color</li>
                    <li id="step-2">Roll the Dice</li>
                    <li id="step-3">Place Your Sprout</li>
                </ol>
                <div id="interactive-controls-container">
                    <div id="color-palette"></div>
                    <div id="dice-container">
                        <div class="dice" data-value="1"><div class="dot"></div></div>
                        <div class="dice" data-value="1"><div class="dot"></div></div>
                    </div>
                </div>
            </div>
            <div id="narration-box"><p id="narration-text"></p></div>
        </div>
        
        <div id="game-container">
            <h1 id="game-title">Little Sprout: Adventure in Nature</h1>
            <div id="game-board-frame"></div>
            <div id="game-board">
                <div id="spots-container"></div>
            </div>
            <div id="opponent-card-hand"></div>
            <div id="card-hand"></div>
            <div id="reveal-section">
                 <h1 id="reveal-title">Play the Adventure Home</h1>
                 <div id="product-container">
                       <div class="product-box"><img src="https://littlesprout.ro/images/standard.jpg" alt="Standard Edition Box Art"><h3>Standard Edition</h3><p>The complete core experience. Everything you need to begin.</p><button class="preorder-btn">Pre-order Now</button></div>
                       <div class="product-box"><img src="https://littlesprout.ro/images/expansion.jpg" alt="Expansion Box Art"><h3>Game Expansion</h3><p>New characters, darker secrets, and greater challenges.</p><button class="preorder-btn">Pre-order Now</button></div>
                       <div class="product-box"><img src="https://littlesprout.ro/images/collector-edition.jpg" alt="Collector's Edition Box Art"><h3>Collector's Edition</h3><p>The ultimate treasure, with exclusive hand-painted miniatures.</p><button class="preorder-btn">Pre-order Now</button></div>
                 </div>
                 <div id="reveal-footer">
                       <button id="replay-button">Replay demo</button>
                       <form class="subscribe-form" onsubmit="game.handleSubscription(event)">
                             <input type="email" id="subscribe-email" placeholder="Enter your email for news...">
                             <button type="submit">Subscribe</button>
                       </form>
                 </div>
            </div>
        </div>
    </div>

    <div id="subscription-alert">
        <span>Thank you for subscribing!</span>
    </div>

    <div id="preorder-modal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-content">
            <div id="preorder-form-container">
                <div class="modal-header">
                    <h3>Pre-order Little Sprout</h3>
                    <button class="modal-close-btn">&times;</button>
                </div>
                <form id="preorder-form" class="modal-body">
                    <div class="form-group">
                        <label for="name">Full Name</label>
                        <input type="text" id="name" placeholder="Elara Vance" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="elara.vance@example.com" required>
                    </div>
                    <div class="form-group">
                        <label for="address">Shipping Address</label>
                        <textarea id="address" rows="3" placeholder="123 Mystic Lane, Spellbound City" required></textarea>
                    </div>
                    <p style="font-size: 0.8rem; text-align: center; opacity: 0.7; margin-bottom: 1rem;">Note: This is a demo. No payment will be processed.</p>
                    <button type="submit">Confirm Pre-order ($49.99)</button>
                </form>
            </div>
            <div id="confirmation-message">
                <svg width="64" height="64" viewBox="0 0 24" fill="none" stroke="var(--color-accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <h3 style="font-size: 1.8rem; color: var(--glow-color); margin-bottom: 0.5rem;">Pre-order Confirmed!</h3>
                <p>Thank you! A confirmation has been sent to your email. We'll notify you when your adventure ships.</p>
                <button id="close-confirmation-btn" style="background: var(--color-accent); color: white; padding: 10px 20px; border-radius: 5px; margin-top: 1.5rem; border: none; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>


    <script>
        const game = {
            elements: {}, state: {}, spotCoordinates: [],
            config: {
                SPOTS_PER_RING: 11,
                PAWN_COLORS: ['#ff6b6b', '#48dbfb', '#1dd1a1', '#feca57', '#ff9f43'],
                CARD_TITLES: ["Woodpecker", "Praying Mantis", "Zander", "Brown Bear", "Romanian Peony", "Clouded Yellow"],
                CARD_IMAGES: [
                    "https://littlesprout.ro/images/card-black-woodpecker.png",
                    "https://littlesprout.ro/images/card-praying-mantis.png",
                    "https://littlesprout.ro/images/card-zander.png",
                    "https://littlesprout.ro/images/card-bear.png",
                    "https://littlesprout.ro/images/card-romanian-peony.png",
                    "https://littlesprout.ro/images/card-clouded-yellow.png"
                ],
                OUTER_RING_COLORS: ['#f7a732','#f0c340','#92c045','#55b64c','#29b9e6','#2b77c8','#4a4aa8','#684196','#9e2a8f','#e53935','#d82b45']
            },
            tutorialSteps: [
                { text: "First, pick a color for your very own Little Sprout.", action: 'promptColor', stepNumber: 1 },
                { text: "Great choice! Now, roll the dice to find your starting spot.", action: 'promptDiceRoll', stepNumber: 2 },
                { text: () => `You rolled a ${game.state.diceSum}! Click the glowing space to pop up!`, action: 'promptPlacePawn', stepNumber: 3 },
                { text: "Your turn! Choose an action from any card in your hand.", action: 'promptPlayerTurn' },
                { text: "Well done! Now it's your friend's turn...", action: 'opponentTurn' },
                { text: "It's your turn again! Choose an action to move even closer.", action: 'promptPlayerTurn' },
                { text: "You made it to the heart of the forest! What an amazing adventure!", action: 'endGameSuccess' }
            ],
            init() { this.cacheElements(); this.createDynamicElements(); this.createBoardLayout(); this.createColorPalette(); this.attachEventListeners(); this.elements.loader.classList.add('hidden'); this.resetGame(true); this.initSlider(this.elements.productContainer); },
            cacheElements() {
                const requiredIds = ['loader','sidebar','narration-text','reveal-section','replay-button','spots-container','dice-container','color-palette','card-hand','opponent-card-hand','game-container','steps-list','game-board', 'game-title', 'product-container', 'subscribe-email', 'subscription-alert', 'preorder-modal', 'interactive-controls-container'];
                requiredIds.forEach(id => { 
                    const element = document.getElementById(id);
                    if (!element) console.error(`Critical element not found: #${id}`); 
                    this.elements[id.replace(/-(\w)/g, (m, l) => l.toUpperCase())] = element; 
                });
                this.elements.dice = this.elements.diceContainer.querySelectorAll('.dice');
                this.elements.preorderModal.overlay = this.elements.preorderModal.querySelector('.modal-overlay');
                this.elements.preorderModal.closeBtn = this.elements.preorderModal.querySelector('.modal-close-btn');
                this.elements.preorderModal.form = this.elements.preorderModal.querySelector('#preorder-form');
                this.elements.preorderModal.formContainer = this.elements.preorderModal.querySelector('#preorder-form-container');
                this.elements.preorderModal.confirmationMsg = this.elements.preorderModal.querySelector('#confirmation-message');
                this.elements.preorderModal.closeConfirmationBtn = this.elements.preorderModal.querySelector('#close-confirmation-btn');
            },
            createDynamicElements() {
                this.elements.playerSprout = this.createPawn('player-sprout');
                this.elements.opponentSprout = this.createPawn('opponent-sprout');
                this.elements.opponentSprout.style.backgroundColor = '#6a0dad';
                
                const isMobile = window.innerWidth <= 768;
                const cardCount = isMobile ? 5 : 6;
                const rotationMultiplier = isMobile ? 7 : 5;
                const centerIndex = (cardCount - 1) / 2;
                
                const playerCardFragment = document.createDocumentFragment();
                this.elements.cardHand.innerHTML = '';
                for(let i = 0; i < cardCount; i++) {
                    const card = document.createElement('div');
                    card.className = 'card';
                    const rotation = (i - centerIndex) * rotationMultiplier;
                    card.style.setProperty('--rotation', `${rotation}deg`);
                    card.innerHTML = `
                        <p class="card-title">${this.config.CARD_TITLES[i] || 'New Card'}</p>
                        <div class="card-actions">
                            <div class="action-dot white" data-move="1" data-tooltip="Draw +1">+1</div>
                            <div class="action-dot black" data-move="2" data-tooltip="Memorize +2">+2</div>
                            <div class="action-dot white" data-move="1" data-tooltip="Interpret +1">+1</div>
                        </div>
                        <div class="card-image-placeholder">
                           <img src="${this.config.CARD_IMAGES[i]}" alt="${this.config.CARD_TITLES[i]}">
                        </div>
                    `;
                    playerCardFragment.appendChild(card);
                }
                this.elements.cardHand.appendChild(playerCardFragment);

                const opponentCardFragment = document.createDocumentFragment();
                this.elements.opponentCardHand.innerHTML = '';
                for(let i = 0; i < cardCount; i++) {
                    const card = document.createElement('div');
                    card.className = 'opponent-card';
                    const rotation = (i - centerIndex) * -rotationMultiplier;
                    card.style.setProperty('--rotation', `${rotation}deg`);
                    opponentCardFragment.appendChild(card);
                }
                this.elements.opponentCardHand.appendChild(opponentCardFragment);
            },
            createPawn(id) { const pawn = document.createElement('div'); pawn.id = id; pawn.className = 'sprout-pawn'; return pawn; },
            createBoardLayout() {
                this.elements.spotsContainer.innerHTML = ''; this.spotCoordinates = []; let spotCounter = 0;
                const rings = [
                    { numSpots: this.config.SPOTS_PER_RING, radius: 280 }, 
                    { numSpots: this.config.SPOTS_PER_RING, radius: 224 },
                    { numSpots: this.config.SPOTS_PER_RING, radius: 168 }, 
                    { numSpots: this.config.SPOTS_PER_RING, radius: 112 },
                    { numSpots: this.config.SPOTS_PER_RING, radius: 56 },
                    { numSpots: 1, radius: 0 }
                ];
                
                const boardWidth = this.elements.gameBoard.getBoundingClientRect().width;

                if (boardWidth === 0) {
                    requestAnimationFrame(() => this.createBoardLayout());
                    return;
                }

                const baseBoardSize = 600;
                const currentBoardScale = boardWidth / baseBoardSize;

                rings.forEach((ring, ringIndex) => {
                    for (let i = 0; i < ring.numSpots; i++) {
                        const angle = (i / ring.numSpots) * 2 * Math.PI - (Math.PI / 2);
                        const x = Math.cos(angle) * ring.radius * currentBoardScale;
                        const y = Math.sin(angle) * ring.radius * currentBoardScale;
                        this.spotCoordinates.push({ x, y });
                        const spot = document.createElement('div');
                        spot.className = 'spot'; spot.id = `spot-${spotCounter}`; spot.style.zIndex = ringIndex + 1;
                        
                        if (ring.radius === 0) {
                            spot.id = 'center-spot';
                        } else if (ringIndex === 0) {
                            spot.innerHTML = `<span>${i + 2}</span>`;
                            spot.addEventListener('click', () => this.handleSpotClick(i));
                        } else if (ringIndex === 1 || ringIndex === 3) {
                            spot.style.backgroundColor = '#000';
                            spot.style.border = 'none';
                        }
                        
                        spot.style.transform = `translate(${x}px, ${y}px)`;
                        this.elements.spotsContainer.appendChild(spot);
                        spotCounter++;
                    }
                });
                this.elements.spotsContainer.appendChild(this.elements.playerSprout);
                this.elements.spotsContainer.appendChild(this.elements.opponentSprout);
                
                if (this.state && this.state.playerPawnPosition > -1) {
                    const playerPos = this.spotCoordinates[this.state.playerPawnPosition];
                    this.elements.playerSprout.style.transform = `translate(${playerPos.x}px, ${playerPos.y}px) scale(1)`;
                }
                if (this.state && this.state.opponentPawnPosition > -1) {
                    const opponentPos = this.spotCoordinates[this.state.opponentPawnPosition];
                    this.elements.opponentSprout.style.transform = `translate(${opponentPos.x}px, ${opponentPos.y}px) scale(1)`;
                }
            },
            createColorPalette() {
                this.elements.colorPalette.innerHTML = '';
                this.config.PAWN_COLORS.forEach(color => {
                    const swatch = document.createElement('div');
                    swatch.className = 'color-swatch';
                    swatch.innerHTML = `
                        <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                            <path d="M16,4 C12.69,4 10,6.69,10,10 C10,13.31 12.69,16 16,16 C19.31,16 22,13.31 22,10 C22,6.69 19.31,4 16,4 Z M16,17 C13,17 11,19 11,22 L21,22 C21,19 19,17 16,17 Z M9,23 L23,23 L23,26 L9,26 Z M7,27 L25,27 L25,29 L7,29 Z" 
                            fill="${color}" stroke="#FFFFFF" stroke-width="1.5" stroke-linejoin="round"/>
                        </svg>
                    `;
                    swatch.addEventListener('click', () => this.handleColorChoice(color));
                    this.elements.colorPalette.appendChild(swatch);
                });
            },
            attachEventListeners() {
                this.elements.replayButton.addEventListener('click', () => this.resetGame());
                this.elements.cardHand.querySelectorAll('.action-dot').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.handleActionChoice(parseInt(btn.dataset.move), e.target);
                    });
                });
                document.querySelectorAll('.preorder-btn').forEach(btn => btn.addEventListener('click', () => this.openPreorderModal()));
                this.elements.preorderModal.overlay.addEventListener('click', () => this.closePreorderModal());
                this.elements.preorderModal.closeBtn.addEventListener('click', () => this.closePreorderModal());
                this.elements.preorderModal.closeConfirmationBtn.addEventListener('click', () => this.closePreorderModal());
                this.elements.preorderModal.form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.elements.preorderModal.formContainer.style.display = 'none';
                    this.elements.preorderModal.confirmationMsg.style.display = 'block';
                });
                window.addEventListener('resize', () => this.createBoardLayout());
            },
            nextStep() {
                this.state.currentStep++;
                if (this.state.currentStep < this.tutorialSteps.length) {
                    const step = this.tutorialSteps[this.state.currentStep];
                    if (step) { this.elements.narrationText.textContent = typeof step.text === 'function' ? step.text() : step.text; this.updateStepsUI(step.stepNumber); this[step.action](); }
                }
            },
            resetGame(isInitialStart = false) {
                if (!isInitialStart) { this.elements.gameBoard.classList.remove('reveal'); this.elements.revealSection.classList.remove('visible'); }
                this.state = { currentStep: -1, diceSum: 0, playerPawnPosition: -1, opponentPawnPosition: -1, selectedPawnColor: this.config.PAWN_COLORS[0], turn: 1, reachedCenter: false, forceMemorize: false };
                this.elements.playerSprout.style.backgroundColor = this.state.selectedPawnColor;
                [this.elements.playerSprout, this.elements.opponentSprout].forEach(pawn => { pawn.style.transition = 'opacity 0s, transform 0s'; pawn.style.opacity = '0'; pawn.style.transform = `scale(0)`; });
                
                this.elements.playerSprout.classList.remove('winning-pawn');
                const existingWinnerText = this.elements.spotsContainer.querySelector('.winner-text');
                if (existingWinnerText) existingWinnerText.remove();
                
                document.querySelectorAll('.spot.glowing').forEach(el => el.classList.remove('glowing'));
                this.elements.cardHand.classList.add('visible'); 
                this.elements.opponentCardHand.classList.add('visible');
                this.elements.opponentCardHand.classList.remove('active');
                this.setHandInteractable(false);
                this.elements.dice.forEach(d => this.updateDieFace(d, 1));
                
                this.elements.colorPalette.classList.remove('visible');
                this.elements.diceContainer.classList.remove('visible');

                if (window.innerWidth <= 768) {
                    this.elements.colorPalette.style.display = 'none';
                    this.elements.diceContainer.style.display = 'none';
                }
                setTimeout(() => this.nextStep(), isInitialStart ? 0 : 1500);
            },
            updateStepsUI(stepNumber) { this.elements.stepsList.querySelectorAll('li').forEach((step, index) => { step.classList.toggle('step-active', index + 1 === stepNumber); }); },
            promptColor() {
                this.updateStepsUI(1);
                this.elements.diceContainer.classList.remove('visible');
                this.elements.colorPalette.classList.add('visible');
                if (window.innerWidth <= 768) {
                    this.elements.diceContainer.style.display = 'none';
                    this.elements.colorPalette.style.display = 'flex';
                }
            },
            promptDiceRoll() {
                this.updateStepsUI(2);
                this.elements.colorPalette.classList.remove('visible');
                this.elements.diceContainer.classList.add('visible', 'selectable');
                if (window.innerWidth <= 768) {
                    this.elements.colorPalette.style.display = 'none';
                    this.elements.diceContainer.style.display = 'flex';
                }
                this.elements.diceContainer.addEventListener('click', () => this.handleDiceRoll(), { once: true });
            },
            promptPlacePawn() { this.updateStepsUI(3); document.getElementById(`spot-${this.state.diceSum - 2}`).classList.add('glowing'); },
            promptPlayerTurn() {
                this.updateStepsUI(0);
                
                if (this.state.forceMemorize) {
                    this.elements.narrationText.textContent = "You recall the murky spot... you must Memorize your findings to proceed. Choose a +2 action.";
                    this.enableForcedMemorizeUI();
                    return; 
                }

                this.setHandInteractable(true); 
                this.elements.opponentCardHand.classList.add('active'); 
                const thirdCardAction = this.elements.cardHand.querySelectorAll('.card')[2].querySelector('.action-dot');
                if(thirdCardAction) thirdCardAction.classList.add('glowing-action');
            },
            enableForcedMemorizeUI() {
                this.elements.cardHand.querySelectorAll('.card').forEach(c => c.classList.remove('inactive'));
                this.elements.cardHand.classList.add('hand-interactable');

                this.elements.cardHand.querySelectorAll('.action-dot').forEach(action => {
                    if (action.dataset.move === '2') {
                        action.classList.add('glowing-action');
                        action.style.pointerEvents = 'auto';
                        action.style.opacity = '1';
                    } else {
                        action.style.pointerEvents = 'none';
                        action.style.opacity = '0.4';
                    }
                });
            },
            opponentTurn() { this.handleOpponentTurn(); },
            endGameSuccess() {
                this.elements.playerSprout.classList.add('winning-pawn');

                const winnerText = document.createElement('div');
                winnerText.textContent = 'Winner!';
                winnerText.className = 'winner-text';
                this.elements.spotsContainer.appendChild(winnerText);

                setTimeout(() => {
                    this.reveal();
                    this.elements.playerSprout.classList.remove('winning-pawn');
                    winnerText.remove();
                }, 2500);
            },
            handleColorChoice(color) { 
                this.state.selectedPawnColor = color; this.elements.playerSprout.style.backgroundColor = color;
                this.elements.colorPalette.classList.remove('visible');
                if (window.innerWidth <= 768) {
                    setTimeout(() => { this.elements.colorPalette.style.display = 'none'; }, 500);
                }
                this.nextStep(); 
            },
            handleDiceRoll() {
                this.elements.diceContainer.classList.remove('selectable'); let rollCount = 0;
                const rollInterval = setInterval(() => {
                    rollCount++;
                    this.elements.dice.forEach(d => { d.classList.add('rolling'); const randomValue = Math.ceil(Math.random() * 6); this.updateDieFace(d, randomValue); });
                    if (rollCount > 5) {
                        clearInterval(rollInterval);
                        const val1 = Math.ceil(Math.random() * 6), val2 = Math.ceil(Math.random() * 6);
                        this.updateDieFace(this.elements.dice[0], val1); this.updateDieFace(this.elements.dice[1], val2);
                        this.state.diceSum = val1 + val2;
                        this.elements.dice.forEach(d => d.classList.remove('rolling'));
                        setTimeout(() => this.nextStep(), 500);
                    }
                }, 100);
            },
            handleSpotClick(index) {
                if (this.state.currentStep !== 2 || index !== this.state.diceSum - 2) return;
                
                this.elements.diceContainer.classList.remove('visible');
                if (window.innerWidth <= 768) {
                    setTimeout(() => { this.elements.diceContainer.style.display = 'none'; }, 500);
                }
                
                document.getElementById(`spot-${index}`).classList.remove('glowing'); this.updateStepsUI(0);
                this.elements.playerSprout.style.transition = 'opacity 0.5s';
                const pos = this.spotCoordinates[index];
                this.elements.playerSprout.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(1)`;

                requestAnimationFrame(() => {
                    this.elements.playerSprout.style.opacity = '1';
                    setTimeout(() => {
                        this.elements.playerSprout.style.transition = 'transform 1s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.5s';
                        this.placeOpponentPawn(index);
                        this.nextStep(); 
                    }, 500);
                });
                this.state.playerPawnPosition = index;
            },
            placeOpponentPawn(playerStartIndex) {
                const opponentStartIndex = (playerStartIndex + 4) % this.config.SPOTS_PER_RING;
                this.state.opponentPawnPosition = opponentStartIndex;
                const pos = this.spotCoordinates[opponentStartIndex];
                this.elements.opponentSprout.style.transition = 'opacity 0.5s';
                this.elements.opponentSprout.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(1)`;
                requestAnimationFrame(() => {
                    this.elements.opponentSprout.style.opacity = '1';
                    setTimeout(() => {
                         this.elements.opponentSprout.style.transition = 'transform 1s cubic-bezier(0.65, 0, 0.35, 1), opacity 0.5s';
                    }, 500);
                });
            },
            handleActionChoice(moveAmount, clickedElement) {
                document.querySelectorAll('.glowing-action').forEach(el => el.classList.remove('glowing-action'));
                this.setHandInteractable(false);
                this.showGamificationText(`+${moveAmount}`, clickedElement);
                
                let newSpotIndex = this.state.playerPawnPosition;
                for (let i = 0; i < moveAmount; i++) { newSpotIndex += this.config.SPOTS_PER_RING; }
                const centerSpotIndex = this.spotCoordinates.length - 1;
                if (newSpotIndex >= centerSpotIndex) { newSpotIndex = centerSpotIndex; this.state.reachedCenter = true; }
                
                if (newSpotIndex !== this.state.playerPawnPosition) {
                    const pos = this.spotCoordinates[newSpotIndex]; 
                    this.elements.playerSprout.style.transform = `translate(${pos.x}px, ${pos.y}px) scale(1)`; 
                    this.state.playerPawnPosition = newSpotIndex;
                }

                if (this.state.forceMemorize && moveAmount === 2) {
                    this.state.forceMemorize = false;
                }

                const ringIndex = Math.floor(this.state.playerPawnPosition / this.config.SPOTS_PER_RING);
                const isBlackSpot = (ringIndex === 1 || ringIndex === 3);

                if (isBlackSpot) {
                    this.state.forceMemorize = true;
                }
                
                let nextFlowStep = this.state.reachedCenter ? 'endGameSuccess' : 'opponentTurn';
                
                if (this.state.turn === 1) this.state.turn = 2;

                this.state.currentStep = this.tutorialSteps.findIndex(s => s.action === nextFlowStep) - 1;
                setTimeout(() => this.nextStep(), 1500);
            },
            handleOpponentTurn() {
                setTimeout(() => {
                    const currentRingIndex = Math.floor(this.state.opponentPawnPosition / this.config.SPOTS_PER_RING);
                    let moveDistance;

                    if (currentRingIndex === 1) {
                        moveDistance = this.config.SPOTS_PER_RING * 2;
                    } else {
                        moveDistance = this.config.SPOTS_PER_RING;
                    }

                    const newPosIndex = this.state.opponentPawnPosition + moveDistance;
                    
                    if (newPosIndex < this.spotCoordinates.length) {
                        const newPos = this.spotCoordinates[newPosIndex];
                        this.elements.opponentSprout.style.transform = `translate(${newPos.x}px, ${newPos.y}px) scale(1)`;
                        this.state.opponentPawnPosition = newPosIndex;
                    }

                    setTimeout(() => this.nextStep(), 1500);
                }, 1000);
            },
            showGamificationText(text, targetElement) {
                const rect = targetElement.getBoundingClientRect();
                const el = document.createElement('div');
                el.textContent = text;
                el.className = 'floating-text';
                el.style.left = `${rect.left + rect.width / 2 - 15}px`;
                el.style.top = `${rect.top - 10}px`;
                document.body.appendChild(el);
                el.addEventListener('animationend', () => el.remove());
            },
            reveal() { 
                this.elements.gameBoard.classList.add('reveal'); this.elements.revealSection.classList.add('visible'); 
                const finalNarrationIndex = this.tutorialSteps.findIndex(s => s.action === 'endGameSuccess');
                this.elements.narrationText.textContent = this.tutorialSteps[finalNarrationIndex].text;
            },
            updateDieFace(dieElement, value) { dieElement.dataset.value = value; let dots = ''; for (let i = 0; i < value; i++) dots += '<div class="dot"></div>'; dieElement.innerHTML = dots; },
            setHandInteractable(isInteractable) {
                if (isInteractable) {
                    this.elements.cardHand.querySelectorAll('.action-dot').forEach(action => {
                        action.style.pointerEvents = '';
                        action.style.opacity = '';
                    });
                }
                this.elements.cardHand.classList.toggle('hand-interactable', isInteractable);
                this.elements.cardHand.querySelectorAll('.card').forEach(card => { card.classList.toggle('inactive', !isInteractable); });
            },
            // MODIFIED: Reworked slider logic to be disabled on mobile
            initSlider(container) {
                const isMobile = window.matchMedia("(max-width: 768px)").matches;
                
                // On mobile, DO NOT initialize the slider. Let CSS handle the simple vertical layout.
                if (isMobile) {
                    return;
                }

                // --- Desktop Slider Logic (unchanged) ---
                let track, slides;
                track = document.createElement('div');
                track.className = 'slider-track';
                while (container.firstChild) {
                    track.appendChild(container.firstChild);
                }
                container.appendChild(track);
                slides = Array.from(track.children);
                
                if (slides.length === 0) return;

                const wrapper = document.createElement('div');
                wrapper.className = 'product-container-wrapper';
                container.parentNode.insertBefore(wrapper, container);
                wrapper.appendChild(container);

                const prevButton = document.createElement('button');
                prevButton.innerHTML = '‹';
                prevButton.className = 'slider-arrow prev';
                wrapper.appendChild(prevButton);

                const nextButton = document.createElement('button');
                nextButton.innerHTML = '›';
                nextButton.className = 'slider-arrow next';
                wrapper.appendChild(nextButton);

                const dotsNav = document.createElement('div');
                dotsNav.className = 'slider-dots';
                wrapper.appendChild(dotsNav);
                slides.forEach((_, i) => {
                    const dot = document.createElement('button');
                    dot.className = 'slider-dot';
                    dotsNav.appendChild(dot);
                    dot.addEventListener('click', () => moveToSlide(i));
                });
                const dots = Array.from(dotsNav.children);

                let currentIndex = 0;

                const getSlideWidth = () => {
                    if (slides.length > 1) {
                        const slideRect = slides[0].getBoundingClientRect();
                        const nextSlideRect = slides[1].getBoundingClientRect();
                        return nextSlideRect.left - slideRect.left;
                    }
                    return slides[0].getBoundingClientRect().width;
                };

                const updateNav = () => {
                    dots.forEach((dot, index) => dot.classList.toggle('active', index === currentIndex));
                    prevButton.style.display = currentIndex === 0 ? 'none' : 'flex';
                    nextButton.style.display = currentIndex === slides.length - 1 ? 'none' : 'flex';
                };
                
                const moveToSlide = (slideIndex) => {
                    const slideWidth = getSlideWidth();
                    currentTranslate = -slideIndex * slideWidth;
                    prevTranslate = currentTranslate;
                    track.style.transform = `translateX(${currentTranslate}px)`;
                    currentIndex = slideIndex;
                    updateNav();
                };
                
                nextButton.addEventListener('click', () => { if (currentIndex < slides.length - 1) moveToSlide(currentIndex + 1); });
                prevButton.addEventListener('click', () => { if (currentIndex > 0) moveToSlide(currentIndex - 1); });

                let isDragging = false, startPos = 0, currentTranslate = 0, prevTranslate = 0, animationID;
                const getPositionX = (e) => e.type.includes('mouse') ? e.pageX : e.touches[0].clientX;
                
                const touchStart = (e) => {
                    startPos = getPositionX(e);
                    isDragging = true;
                    animationID = requestAnimationFrame(animation);
                    track.style.transition = 'none';
                    e.preventDefault();
                };
                const touchMove = (e) => {
                    if (isDragging) currentTranslate = prevTranslate + getPositionX(e) - startPos;
                };
                const touchEnd = () => {
                    cancelAnimationFrame(animationID);
                    isDragging = false;
                    const movedBy = currentTranslate - prevTranslate;
                    if (movedBy < -100 && currentIndex < slides.length - 1) currentIndex++;
                    if (movedBy > 100 && currentIndex > 0) currentIndex--;
                    track.style.transition = 'transform 0.5s ease-in-out';
                    moveToSlide(currentIndex);
                };
                const animation = () => {
                    track.style.transform = `translateX(${currentTranslate}px)`;
                    if (isDragging) requestAnimationFrame(animation);
                };
                
                track.addEventListener('mousedown', touchStart);
                track.addEventListener('touchstart', touchStart, { passive: false });
                window.addEventListener('mousemove', touchMove);
                window.addEventListener('touchmove', touchMove, { passive: false });
                window.addEventListener('mouseup', touchEnd);
                window.addEventListener('touchend', touchEnd);
                window.addEventListener('mouseleave', () => { if (isDragging) touchEnd(); });
                
                updateNav();
                window.addEventListener('resize', () => moveToSlide(currentIndex));
            },
            handleSubscription(event) {
                event.preventDefault();
                const emailInput = this.elements.subscribeEmail;
                if (emailInput.value && emailInput.value.includes('@')) {
                    this.elements.subscriptionAlert.classList.add('visible');
                    setTimeout(() => {
                        this.elements.subscriptionAlert.classList.remove('visible');
                    }, 3000);
                    emailInput.value = '';
                } else {
                    emailInput.style.borderColor = '#ff6b6b';
                    setTimeout(() => { emailInput.style.borderColor = 'var(--color-accent)'; }, 2000);
                }
            },
            openPreorderModal() {
                this.elements.preorderModal.form.reset();
                this.elements.preorderModal.formContainer.style.display = 'block';
                this.elements.preorderModal.confirmationMsg.style.display = 'none';
                this.elements.preorderModal.classList.add('visible');
            },
            closePreorderModal() {
                this.elements.preorderModal.classList.remove('visible');
            }
        };
        document.addEventListener('DOMContentLoaded', () => { setTimeout(() => game.init(), 0); });
    </script>
</body>
</html>